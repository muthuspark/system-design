<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.39">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Monitoring System Design – System Design Notes</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../">
<link href="../../../favicon.ico" rel="icon">
<script src="../../../site_libs/quarto-html/quarto.js"></script>
<script src="../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../site_libs/bootstrap/bootstrap-5c1aa57916d092647891b8a3fe59897e.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../../site_libs/bootstrap/bootstrap-dark-ee5e052b81fc94e1f9bb89611f476562.min.css" rel="prefetch" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<meta name="mermaid-theme" content="neutral">
<script src="../../../site_libs/quarto-diagram/mermaid.min.js"></script>
<script src="../../../site_libs/quarto-diagram/mermaid-init.js"></script>
<link href="../../../site_libs/quarto-diagram/mermaid.css" rel="stylesheet">


<link rel="stylesheet" href="../../../styles.css">
<meta property="og:title" content="Monitoring System Design – System Design Notes">
<meta property="og:description" content="">
<meta property="og:site_name" content="System Design Notes">
</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../../index.html">
    <span class="navbar-title">System Design Notes</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/muthuspark"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/krimuthu"> <i class="bi bi-twitter" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Monitoring System Design</h1>
  <div class="quarto-categories">
    <div class="quarto-category">Infrastructure</div>
  </div>
  </div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>Monitoring systems are the lifeblood of any application. They provide important information about the health, performance, and behavior of your software, allowing you to proactively identify and resolve issues before they impact users. Designing an effective monitoring system, however, is a complex undertaking requiring careful consideration of many key aspects. This post goes into the important components and considerations for building a detailed monitoring solution.</p>
<section id="defining-objectives-and-scope" class="level2">
<h2 data-anchor-id="defining-objectives-and-scope">1. Defining Objectives and Scope</h2>
<p>Before diving into the technical details, it’s important to clearly define the goals of your monitoring system. What specific aspects of your application do you need to monitor? What metrics are most important? Are you primarily focused on performance, security, or availability? The answers to these questions will influence the design and implementation of your system.</p>
<p>For example, a simple web application might only need to monitor CPU usage, memory consumption, and response times. A complex microservices architecture, on the other hand, will require a much more complex system capable of tracking inter-service communication, latency, and error rates across multiple components.</p>
</section>
<section id="data-sources-and-collection" class="level2">
<h2 data-anchor-id="data-sources-and-collection">2. Data Sources and Collection</h2>
<p>The next step involves identifying the sources of the data you need to monitor. This could include:</p>
<ul>
<li><strong>Application Logs:</strong> These provide information about the internal workings of your application, including errors, warnings, and debug messages.</li>
<li><strong>System Metrics:</strong> Operating system metrics such as CPU utilization, memory usage, disk I/O, and network traffic are important indicators of system health.</li>
<li><strong>Application Metrics:</strong> These metrics are specific to your application and often include performance counters, business KPIs (Key Performance Indicators), and custom events.</li>
<li><strong>Infrastructure Metrics:</strong> Metrics related to your infrastructure, such as network bandwidth, storage capacity, and server availability.</li>
<li><strong>Third-Party APIs:</strong> Integrating with external services can provide additional context and insights.</li>
</ul>
<p><strong>Example using Prometheus (a popular monitoring system):</strong></p>
<div class="sourceCode" id="cb1"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> prometheus_client <span class="im">import</span> Gauge, start_http_server</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>requests_total <span class="op">=</span> Gauge(<span class="st">'requests_total'</span>, <span class="st">'Total number of requests'</span>)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> handle_request(request):</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># ... process the request ...</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>    requests_total.inc()</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># ... more logic ...</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">'__main__'</span>:</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>    start_http_server(<span class="dv">8000</span>)  <span class="co"># Start Prometheus exporter</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># ... run your webserver ...</span></span></code></pre></div>
<p>This example shows how to expose a simple metric (total requests) using the Prometheus client library in Python.</p>
</section>
<section id="data-processing-and-aggregation" class="level2">
<h2 data-anchor-id="data-processing-and-aggregation">3. Data Processing and Aggregation</h2>
<p>Raw monitoring data is often too voluminous and granular for direct analysis. A data processing layer is therefore necessary to aggregate, filter, and transform the data into a more manageable format. This often involves:</p>
<ul>
<li><strong>Filtering:</strong> Removing irrelevant or noisy data.</li>
<li><strong>Aggregation:</strong> Combining multiple data points into summary statistics (e.g., averages, percentiles).</li>
<li><strong>Transformation:</strong> Converting data into a more usable format.</li>
</ul>
<p>This stage might involve using tools like Apache Kafka, Fluentd, or Logstash for log processing and data streaming, and tools like Elasticsearch or InfluxDB for data storage and querying.</p>
</section>
<section id="storage-and-databases" class="level2">
<h2 data-anchor-id="storage-and-databases">4. Storage and Databases</h2>
<p>The choice of database depends on the volume and type of data you’re collecting. Options include:</p>
<ul>
<li><strong>Time-series databases (TSDBs):</strong> Optimized for storing and querying time-stamped data, ideal for metrics and events. Examples include InfluxDB, Prometheus, and TimescaleDB.</li>
<li><strong>Document databases:</strong> Suitable for storing less structured data, such as logs. MongoDB is a popular example.</li>
<li><strong>Relational databases:</strong> Can be used, but often less efficient than TSDBs for high-volume time-series data.</li>
</ul>
</section>
<section id="visualization-and-alerting" class="level2">
<h2 data-anchor-id="visualization-and-alerting">5. Visualization and Alerting</h2>
<p>The final step involves visualizing the collected data and setting up alerts to notify you of critical events. Popular tools include:</p>
<ul>
<li><strong><a href="https://grafana.com/">Grafana</a>:</strong> A powerful open-source dashboarding and visualization tool.</li>
<li><strong><a href="https://www.elastic.co/products/kibana">Kibana</a>:</strong> Part of the Elastic Stack, used for visualizing logs and metrics.</li>
<li><strong><a href="https://www.datadoghq.com/">Datadog</a>:</strong> A commercial monitoring platform with detailed features.</li>
</ul>
<p><strong>Alerting</strong> can be implemented through email, SMS, PagerDuty, or other notification systems. It’s important to define clear alert thresholds and avoid alert fatigue.</p>
</section>
<section id="system-architecture-diagram" class="level2">
<h2 data-anchor-id="system-architecture-diagram">6. System Architecture Diagram</h2>
<p>The following diagram illustrates a typical monitoring system architecture:</p>
<div class="cell" data-layout-align="default">
<div class="cell-output-display">
<div>
<p></p><figure class="figure"><p></p>
<div>
<pre class="mermaid mermaid-js">graph TB
    subgraph Sources
        A[Applications]
        H[Servers]
        I[Network]
    end

    subgraph Collection
        B[Collection Agents]
    end

    subgraph Processing
        C[Kafka]
        G[Elasticsearch]
    end

    subgraph Storage
        D[InfluxDB]
    end

    subgraph Visualization
        E[Grafana]
    end

    subgraph Alerting
        F[PagerDuty]
    end

    A &amp; H &amp; I --&gt; B
    B --&gt; C
    B --&gt; G
    C --&gt; D
    D --&gt; E
    G --&gt; E
    E --&gt; F
</pre>
</div>
<p></p></figure><p></p>
</div>
</div>
</div>
<p>The monitoring system architecture consists of many key layers:</p>
<p><strong>1. Sources Layer</strong></p>
<ul>
<li>Applications: Generate metrics, logs, traces</li>
<li>Servers: System metrics (CPU, memory, disk)</li>
<li>Network: Traffic, latency, connectivity data</li>
</ul>
<p><strong>2. Collection Layer</strong></p>
<ul>
<li>Collection Agents (e.g., Prometheus exporters, Beats)</li>
<li>Scrapes metrics from sources</li>
<li>Formats data for processing</li>
<li>Handles local buffering</li>
</ul>
<p><strong>3. Processing Layer</strong></p>
<ul>
<li>Kafka: Handles real-time data streaming
<ul>
<li>Buffers high-volume metrics</li>
<li>Enables data transformation</li>
</ul></li>
<li>Elasticsearch: Log aggregation and search
<ul>
<li>Full-text search capabilities</li>
<li>Log parsing and indexing</li>
</ul></li>
</ul>
<p><strong>4. Storage Layer</strong></p>
<ul>
<li>InfluxDB: Time-series database
<ul>
<li>Optimized for metrics storage</li>
<li>Data retention policies</li>
<li>Query performance</li>
</ul></li>
</ul>
<p><strong>5. Visualization Layer</strong></p>
<ul>
<li>Grafana: Dashboards and analytics
<ul>
<li>Real-time monitoring</li>
<li>Custom visualizations</li>
<li>Query building</li>
</ul></li>
</ul>
<p><strong>6. Alerting Layer</strong></p>
<ul>
<li>PagerDuty: Alert management
<ul>
<li>Incident routing</li>
<li>On-call schedules</li>
<li>Alert escalation</li>
</ul></li>
</ul>
<p>Data flows from sources through collection, processing, storage, and finally to visualization/alerting for analysis and response.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/system-design\.muthu\.co\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Copyright 2025, Muthukrishnan</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>




</body></html>